<?php

namespace WeatherRestApiBundle\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\Controller;
use Symfony\Component\HttpClient\HttpClient;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Contracts\HttpClient\Exception\ClientExceptionInterface;
use Symfony\Contracts\HttpClient\Exception\RedirectionExceptionInterface;
use Symfony\Contracts\HttpClient\Exception\ServerExceptionInterface;
use Symfony\Contracts\HttpClient\Exception\TransportExceptionInterface;
use WeatherBundle\Entity\Town;
use WeatherBundle\Entity\UsersTowns;


class WeatherController extends Controller
{
    /**
     * @Route("/forecast", name="rest_api_forecast")
     * @param Request $request
     * @return Response
     * @throws ClientExceptionInterface
     * @throws RedirectionExceptionInterface
     * @throws ServerExceptionInterface
     * @throws TransportExceptionInterface
     */
    public function indexAction(Request $request)
    {
        $townId = $request->request->get('town_id');
        $townRepository = $this->getDoctrine()->getRepository(Town::class);
        /**
         * @var Town $town
         */
        $town = $townRepository->find($townId);

        $response = [];
        $response['error_message'] = '';
        if ($town !== null) {
            $townName = $town->getName();

            $client = HttpClient::create();
            $clientResponse = $client
                ->request(
                    'GET',
                    "http://api.worldweatheronline.com/premium/v1/weather.ashx?key=8a924ec35c774eceb52162003201802&q=$townName&format=json&num_of_days=7"
                );
            //$json = '{"data":{"request":[{"type":"City","query":"Sofia, Bulgaria"}],"current_condition":[{"observation_time":"09:11 PM","temp_C":"6","temp_F":"43","weatherCode":"113","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0008_clear_sky_night.png"}],"weatherDesc":[{"value":"Clear"}],"windspeedMiles":"14","windspeedKmph":"22","winddirDegree":"270","winddir16Point":"W","precipMM":"0.0","precipInches":"0.0","humidity":"81","visibility":"10","visibilityMiles":"6","pressure":"1021","pressureInches":"31","cloudcover":"0","FeelsLikeC":"2","FeelsLikeF":"36","uvIndex":1}],"weather":[{"date":"2020-02-18","astronomy":[{"sunrise":"07:20 AM","sunset":"06:01 PM","moonrise":"03:46 AM","moonset":"01:04 PM","moon_phase":"Last Quarter","moon_illumination":"22"}],"maxtempC":"14","maxtempF":"57","mintempC":"2","mintempF":"36","avgtempC":"7","avgtempF":"44","totalSnow_cm":"0.0","sunHour":"10.8","uvIndex":"1","hourly":[{"time":"0","tempC":"4","tempF":"39","windspeedMiles":"1","windspeedKmph":"2","winddirDegree":"166","winddir16Point":"SSE","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"72","visibility":"10","visibilityMiles":"6","pressure":"1023","pressureInches":"31","cloudcover":"9","HeatIndexC":"4","HeatIndexF":"39","DewPointC":"-1","DewPointF":"31","WindChillC":"4","WindChillF":"39","WindGustMiles":"3","WindGustKmph":"5","FeelsLikeC":"4","FeelsLikeF":"39","chanceofrain":"0","chanceofremdry":"93","chanceofwindy":"0","chanceofovercast":"31","chanceofsunshine":"85","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"300","tempC":"3","tempF":"37","windspeedMiles":"1","windspeedKmph":"1","winddirDegree":"207","winddir16Point":"SSW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"72","visibility":"10","visibilityMiles":"6","pressure":"1023","pressureInches":"31","cloudcover":"15","HeatIndexC":"3","HeatIndexF":"37","DewPointC":"-2","DewPointF":"29","WindChillC":"3","WindChillF":"37","WindGustMiles":"2","WindGustKmph":"3","FeelsLikeC":"3","FeelsLikeF":"37","chanceofrain":"0","chanceofremdry":"90","chanceofwindy":"0","chanceofovercast":"33","chanceofsunshine":"79","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"600","tempC":"2","tempF":"36","windspeedMiles":"1","windspeedKmph":"2","winddirDegree":"250","winddir16Point":"WSW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"71","visibility":"10","visibilityMiles":"6","pressure":"1022","pressureInches":"31","cloudcover":"20","HeatIndexC":"2","HeatIndexF":"36","DewPointC":"-2","DewPointF":"28","WindChillC":"2","WindChillF":"36","WindGustMiles":"2","WindGustKmph":"4","FeelsLikeC":"2","FeelsLikeF":"36","chanceofrain":"0","chanceofremdry":"81","chanceofwindy":"0","chanceofovercast":"39","chanceofsunshine":"74","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"900","tempC":"6","tempF":"42","windspeedMiles":"2","windspeedKmph":"4","winddirDegree":"277","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"63","visibility":"10","visibilityMiles":"6","pressure":"1022","pressureInches":"31","cloudcover":"18","HeatIndexC":"6","HeatIndexF":"42","DewPointC":"-1","DewPointF":"30","WindChillC":"5","WindChillF":"42","WindGustMiles":"3","WindGustKmph":"5","FeelsLikeC":"5","FeelsLikeF":"42","chanceofrain":"0","chanceofremdry":"84","chanceofwindy":"0","chanceofovercast":"45","chanceofsunshine":"79","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1200","tempC":"12","tempF":"54","windspeedMiles":"4","windspeedKmph":"7","winddirDegree":"304","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"48","visibility":"10","visibilityMiles":"6","pressure":"1020","pressureInches":"31","cloudcover":"12","HeatIndexC":"12","HeatIndexF":"54","DewPointC":"1","DewPointF":"34","WindChillC":"12","WindChillF":"53","WindGustMiles":"5","WindGustKmph":"8","FeelsLikeC":"12","FeelsLikeF":"53","chanceofrain":"0","chanceofremdry":"92","chanceofwindy":"0","chanceofovercast":"40","chanceofsunshine":"78","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1500","tempC":"13","tempF":"55","windspeedMiles":"7","windspeedKmph":"12","winddirDegree":"306","winddir16Point":"NW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"54","visibility":"10","visibilityMiles":"6","pressure":"1019","pressureInches":"31","cloudcover":"4","HeatIndexC":"13","HeatIndexF":"55","DewPointC":"3","DewPointF":"38","WindChillC":"11","WindChillF":"53","WindGustMiles":"10","WindGustKmph":"16","FeelsLikeC":"11","FeelsLikeF":"53","chanceofrain":"0","chanceofremdry":"86","chanceofwindy":"0","chanceofovercast":"36","chanceofsunshine":"83","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1800","tempC":"8","tempF":"47","windspeedMiles":"8","windspeedKmph":"13","winddirDegree":"292","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"72","visibility":"10","visibilityMiles":"6","pressure":"1020","pressureInches":"31","cloudcover":"11","HeatIndexC":"8","HeatIndexF":"47","DewPointC":"3","DewPointF":"38","WindChillC":"6","WindChillF":"43","WindGustMiles":"13","WindGustKmph":"22","FeelsLikeC":"6","FeelsLikeF":"43","chanceofrain":"0","chanceofremdry":"81","chanceofwindy":"0","chanceofovercast":"40","chanceofsunshine":"77","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"2100","tempC":"5","tempF":"41","windspeedMiles":"5","windspeedKmph":"8","winddirDegree":"283","winddir16Point":"WNW","weatherCode":"119","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0003_white_cloud.png"}],"weatherDesc":[{"value":"Cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"87","visibility":"10","visibilityMiles":"6","pressure":"1021","pressureInches":"31","cloudcover":"34","HeatIndexC":"5","HeatIndexF":"41","DewPointC":"3","DewPointF":"38","WindChillC":"3","WindChillF":"38","WindGustMiles":"10","WindGustKmph":"15","FeelsLikeC":"3","FeelsLikeF":"38","chanceofrain":"0","chanceofremdry":"86","chanceofwindy":"0","chanceofovercast":"56","chanceofsunshine":"56","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"}]},{"date":"2020-02-19","astronomy":[{"sunrise":"07:19 AM","sunset":"06:03 PM","moonrise":"04:44 AM","moonset":"01:55 PM","moon_phase":"Waning Crescent","moon_illumination":"15"}],"maxtempC":"10","maxtempF":"49","mintempC":"3","mintempF":"38","avgtempC":"6","avgtempF":"43","totalSnow_cm":"0.0","sunHour":"8.5","uvIndex":"1","hourly":[{"time":"0","tempC":"4","tempF":"39","windspeedMiles":"6","windspeedKmph":"9","winddirDegree":"295","winddir16Point":"WNW","weatherCode":"119","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0003_white_cloud.png"}],"weatherDesc":[{"value":"Cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"90","visibility":"10","visibilityMiles":"6","pressure":"1022","pressureInches":"31","cloudcover":"66","HeatIndexC":"4","HeatIndexF":"39","DewPointC":"3","DewPointF":"37","WindChillC":"2","WindChillF":"35","WindGustMiles":"11","WindGustKmph":"17","FeelsLikeC":"2","FeelsLikeF":"35","chanceofrain":"0","chanceofremdry":"90","chanceofwindy":"0","chanceofovercast":"92","chanceofsunshine":"14","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"300","tempC":"4","tempF":"39","windspeedMiles":"5","windspeedKmph":"8","winddirDegree":"299","winddir16Point":"WNW","weatherCode":"122","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Overcast"}],"precipMM":"0.0","precipInches":"0.0","humidity":"87","visibility":"10","visibilityMiles":"6","pressure":"1022","pressureInches":"31","cloudcover":"81","HeatIndexC":"4","HeatIndexF":"39","DewPointC":"2","DewPointF":"35","WindChillC":"2","WindChillF":"35","WindGustMiles":"8","WindGustKmph":"13","FeelsLikeC":"2","FeelsLikeF":"35","chanceofrain":"0","chanceofremdry":"87","chanceofwindy":"0","chanceofovercast":"92","chanceofsunshine":"14","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"600","tempC":"4","tempF":"38","windspeedMiles":"4","windspeedKmph":"6","winddirDegree":"302","winddir16Point":"WNW","weatherCode":"119","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0003_white_cloud.png"}],"weatherDesc":[{"value":"Cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"89","visibility":"10","visibilityMiles":"6","pressure":"1022","pressureInches":"31","cloudcover":"89","HeatIndexC":"4","HeatIndexF":"38","DewPointC":"2","DewPointF":"35","WindChillC":"2","WindChillF":"36","WindGustMiles":"6","WindGustKmph":"9","FeelsLikeC":"2","FeelsLikeF":"36","chanceofrain":"0","chanceofremdry":"87","chanceofwindy":"0","chanceofovercast":"85","chanceofsunshine":"12","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"900","tempC":"5","tempF":"41","windspeedMiles":"3","windspeedKmph":"5","winddirDegree":"303","winddir16Point":"WNW","weatherCode":"119","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0003_white_cloud.png"}],"weatherDesc":[{"value":"Cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"83","visibility":"10","visibilityMiles":"6","pressure":"1022","pressureInches":"31","cloudcover":"71","HeatIndexC":"5","HeatIndexF":"41","DewPointC":"2","DewPointF":"36","WindChillC":"4","WindChillF":"39","WindGustMiles":"4","WindGustKmph":"6","FeelsLikeC":"4","FeelsLikeF":"39","chanceofrain":"0","chanceofremdry":"87","chanceofwindy":"0","chanceofovercast":"85","chanceofsunshine":"15","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1200","tempC":"8","tempF":"47","windspeedMiles":"3","windspeedKmph":"5","winddirDegree":"293","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"69","visibility":"10","visibilityMiles":"6","pressure":"1020","pressureInches":"31","cloudcover":"71","HeatIndexC":"8","HeatIndexF":"47","DewPointC":"3","DewPointF":"37","WindChillC":"8","WindChillF":"46","WindGustMiles":"4","WindGustKmph":"6","FeelsLikeC":"8","FeelsLikeF":"46","chanceofrain":"0","chanceofremdry":"90","chanceofwindy":"0","chanceofovercast":"77","chanceofsunshine":"33","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1500","tempC":"10","tempF":"49","windspeedMiles":"3","windspeedKmph":"5","winddirDegree":"293","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"64","visibility":"10","visibilityMiles":"6","pressure":"1018","pressureInches":"31","cloudcover":"55","HeatIndexC":"10","HeatIndexF":"49","DewPointC":"3","DewPointF":"38","WindChillC":"9","WindChillF":"49","WindGustMiles":"4","WindGustKmph":"6","FeelsLikeC":"9","FeelsLikeF":"49","chanceofrain":"0","chanceofremdry":"85","chanceofwindy":"0","chanceofovercast":"42","chanceofsunshine":"79","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1800","tempC":"9","tempF":"47","windspeedMiles":"2","windspeedKmph":"4","winddirDegree":"222","winddir16Point":"SW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"70","visibility":"10","visibilityMiles":"6","pressure":"1017","pressureInches":"31","cloudcover":"48","HeatIndexC":"9","HeatIndexF":"47","DewPointC":"3","DewPointF":"38","WindChillC":"9","WindChillF":"47","WindGustMiles":"3","WindGustKmph":"4","FeelsLikeC":"9","FeelsLikeF":"47","chanceofrain":"0","chanceofremdry":"85","chanceofwindy":"0","chanceofovercast":"33","chanceofsunshine":"79","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"2100","tempC":"7","tempF":"44","windspeedMiles":"2","windspeedKmph":"3","winddirDegree":"33","winddir16Point":"NNE","weatherCode":"122","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Overcast"}],"precipMM":"0.0","precipInches":"0.0","humidity":"79","visibility":"10","visibilityMiles":"6","pressure":"1017","pressureInches":"30","cloudcover":"67","HeatIndexC":"7","HeatIndexF":"44","DewPointC":"3","DewPointF":"38","WindChillC":"7","WindChillF":"44","WindGustMiles":"2","WindGustKmph":"4","FeelsLikeC":"7","FeelsLikeF":"44","chanceofrain":"0","chanceofremdry":"84","chanceofwindy":"0","chanceofovercast":"55","chanceofsunshine":"56","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"}]},{"date":"2020-02-20","astronomy":[{"sunrise":"07:17 AM","sunset":"06:04 PM","moonrise":"05:36 AM","moonset":"02:51 PM","moon_phase":"Waning Crescent","moon_illumination":"7"}],"maxtempC":"5","maxtempF":"42","mintempC":"1","mintempF":"33","avgtempC":"4","avgtempF":"39","totalSnow_cm":"0.7","sunHour":"5.4","uvIndex":"1","hourly":[{"time":"0","tempC":"6","tempF":"42","windspeedMiles":"2","windspeedKmph":"3","winddirDegree":"128","winddir16Point":"SE","weatherCode":"266","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0033_cloudy_with_light_rain_night.png"}],"weatherDesc":[{"value":"Light drizzle"}],"precipMM":"0.1","precipInches":"0.0","humidity":"86","visibility":"7","visibilityMiles":"4","pressure":"1016","pressureInches":"30","cloudcover":"98","HeatIndexC":"6","HeatIndexF":"42","DewPointC":"4","DewPointF":"38","WindChillC":"6","WindChillF":"42","WindGustMiles":"2","WindGustKmph":"4","FeelsLikeC":"6","FeelsLikeF":"42","chanceofrain":"21","chanceofremdry":"61","chanceofwindy":"0","chanceofovercast":"87","chanceofsunshine":"7","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"300","tempC":"5","tempF":"42","windspeedMiles":"3","windspeedKmph":"5","winddirDegree":"336","winddir16Point":"NNW","weatherCode":"266","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0033_cloudy_with_light_rain_night.png"}],"weatherDesc":[{"value":"Light drizzle"}],"precipMM":"0.4","precipInches":"0.0","humidity":"88","visibility":"2","visibilityMiles":"1","pressure":"1016","pressureInches":"30","cloudcover":"96","HeatIndexC":"5","HeatIndexF":"42","DewPointC":"3","DewPointF":"38","WindChillC":"5","WindChillF":"40","WindGustMiles":"3","WindGustKmph":"5","FeelsLikeC":"5","FeelsLikeF":"40","chanceofrain":"65","chanceofremdry":"0","chanceofwindy":"0","chanceofovercast":"82","chanceofsunshine":"0","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"600","tempC":"4","tempF":"40","windspeedMiles":"4","windspeedKmph":"6","winddirDegree":"340","winddir16Point":"NNW","weatherCode":"296","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0033_cloudy_with_light_rain_night.png"}],"weatherDesc":[{"value":"Light rain"}],"precipMM":"0.7","precipInches":"0.0","humidity":"88","visibility":"4","visibilityMiles":"2","pressure":"1016","pressureInches":"30","cloudcover":"88","HeatIndexC":"4","HeatIndexF":"40","DewPointC":"3","DewPointF":"37","WindChillC":"3","WindChillF":"37","WindGustMiles":"4","WindGustKmph":"7","FeelsLikeC":"3","FeelsLikeF":"37","chanceofrain":"71","chanceofremdry":"0","chanceofwindy":"0","chanceofovercast":"85","chanceofsunshine":"0","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"900","tempC":"4","tempF":"39","windspeedMiles":"4","windspeedKmph":"7","winddirDegree":"340","winddir16Point":"NNW","weatherCode":"317","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0021_cloudy_with_sleet.png"}],"weatherDesc":[{"value":"Light sleet"}],"precipMM":"1.0","precipInches":"0.0","humidity":"91","visibility":"9","visibilityMiles":"5","pressure":"1017","pressureInches":"31","cloudcover":"91","HeatIndexC":"4","HeatIndexF":"39","DewPointC":"3","DewPointF":"37","WindChillC":"2","WindChillF":"36","WindGustMiles":"5","WindGustKmph":"8","FeelsLikeC":"2","FeelsLikeF":"36","chanceofrain":"73","chanceofremdry":"0","chanceofwindy":"0","chanceofovercast":"87","chanceofsunshine":"0","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1200","tempC":"5","tempF":"40","windspeedMiles":"6","windspeedKmph":"9","winddirDegree":"331","winddir16Point":"NNW","weatherCode":"296","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0017_cloudy_with_light_rain.png"}],"weatherDesc":[{"value":"Light rain"}],"precipMM":"0.8","precipInches":"0.0","humidity":"85","visibility":"9","visibilityMiles":"5","pressure":"1018","pressureInches":"31","cloudcover":"100","HeatIndexC":"5","HeatIndexF":"40","DewPointC":"2","DewPointF":"36","WindChillC":"2","WindChillF":"36","WindGustMiles":"6","WindGustKmph":"10","FeelsLikeC":"2","FeelsLikeF":"36","chanceofrain":"64","chanceofremdry":"0","chanceofwindy":"0","chanceofovercast":"85","chanceofsunshine":"0","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1500","tempC":"5","tempF":"41","windspeedMiles":"6","windspeedKmph":"10","winddirDegree":"338","winddir16Point":"NNW","weatherCode":"317","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0021_cloudy_with_sleet.png"}],"weatherDesc":[{"value":"Light sleet"}],"precipMM":"1.0","precipInches":"0.0","humidity":"79","visibility":"9","visibilityMiles":"5","pressure":"1018","pressureInches":"31","cloudcover":"100","HeatIndexC":"5","HeatIndexF":"41","DewPointC":"2","DewPointF":"35","WindChillC":"3","WindChillF":"37","WindGustMiles":"7","WindGustKmph":"12","FeelsLikeC":"3","FeelsLikeF":"37","chanceofrain":"67","chanceofremdry":"0","chanceofwindy":"0","chanceofovercast":"86","chanceofsunshine":"0","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1800","tempC":"4","tempF":"39","windspeedMiles":"5","windspeedKmph":"8","winddirDegree":"341","winddir16Point":"NNW","weatherCode":"317","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0021_cloudy_with_sleet.png"}],"weatherDesc":[{"value":"Light sleet"}],"precipMM":"0.8","precipInches":"0.0","humidity":"87","visibility":"9","visibilityMiles":"5","pressure":"1019","pressureInches":"31","cloudcover":"95","HeatIndexC":"4","HeatIndexF":"39","DewPointC":"2","DewPointF":"35","WindChillC":"2","WindChillF":"35","WindGustMiles":"6","WindGustKmph":"9","FeelsLikeC":"2","FeelsLikeF":"35","chanceofrain":"71","chanceofremdry":"0","chanceofwindy":"0","chanceofovercast":"87","chanceofsunshine":"0","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"2100","tempC":"2","tempF":"36","windspeedMiles":"4","windspeedKmph":"7","winddirDegree":"323","winddir16Point":"NW","weatherCode":"329","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0036_cloudy_with_heavy_snow_night.png"}],"weatherDesc":[{"value":"Patchy moderate snow"}],"precipMM":"0.8","precipInches":"0.0","humidity":"83","visibility":"8","visibilityMiles":"5","pressure":"1021","pressureInches":"31","cloudcover":"84","HeatIndexC":"2","HeatIndexF":"36","DewPointC":"-0","DewPointF":"32","WindChillC":"0","WindChillF":"33","WindGustMiles":"6","WindGustKmph":"9","FeelsLikeC":"0","FeelsLikeF":"33","chanceofrain":"49","chanceofremdry":"0","chanceofwindy":"0","chanceofovercast":"83","chanceofsunshine":"0","chanceoffrost":"5","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"25","chanceofthunder":"0","uvIndex":"1"}]},{"date":"2020-02-21","astronomy":[{"sunrise":"07:16 AM","sunset":"06:05 PM","moonrise":"06:19 AM","moonset":"03:51 PM","moon_phase":"New Moon","moon_illumination":"0"}],"maxtempC":"7","maxtempF":"44","mintempC":"-0","mintempF":"31","avgtempC":"3","avgtempF":"37","totalSnow_cm":"0.0","sunHour":"10.1","uvIndex":"1","hourly":[{"time":"0","tempC":"1","tempF":"33","windspeedMiles":"5","windspeedKmph":"8","winddirDegree":"304","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.1","precipInches":"0.0","humidity":"82","visibility":"8","visibilityMiles":"4","pressure":"1022","pressureInches":"31","cloudcover":"70","HeatIndexC":"1","HeatIndexF":"33","DewPointC":"-2","DewPointF":"28","WindChillC":"-2","WindChillF":"28","WindGustMiles":"6","WindGustKmph":"10","FeelsLikeC":"-2","FeelsLikeF":"28","chanceofrain":"0","chanceofremdry":"28","chanceofwindy":"0","chanceofovercast":"70","chanceofsunshine":"25","chanceoffrost":"15","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"51","chanceofthunder":"0","uvIndex":"1"},{"time":"300","tempC":"0","tempF":"32","windspeedMiles":"4","windspeedKmph":"7","winddirDegree":"297","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"83","visibility":"10","visibilityMiles":"6","pressure":"1023","pressureInches":"31","cloudcover":"51","HeatIndexC":"0","HeatIndexF":"32","DewPointC":"-3","DewPointF":"28","WindChillC":"-2","WindChillF":"28","WindGustMiles":"5","WindGustKmph":"8","FeelsLikeC":"-2","FeelsLikeF":"28","chanceofrain":"0","chanceofremdry":"85","chanceofwindy":"0","chanceofovercast":"43","chanceofsunshine":"78","chanceoffrost":"20","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"600","tempC":"-0","tempF":"32","windspeedMiles":"4","windspeedKmph":"6","winddirDegree":"303","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"84","visibility":"10","visibilityMiles":"6","pressure":"1023","pressureInches":"31","cloudcover":"61","HeatIndexC":"-0","HeatIndexF":"32","DewPointC":"-3","DewPointF":"28","WindChillC":"-2","WindChillF":"28","WindGustMiles":"4","WindGustKmph":"7","FeelsLikeC":"-2","FeelsLikeF":"28","chanceofrain":"0","chanceofremdry":"88","chanceofwindy":"0","chanceofovercast":"44","chanceofsunshine":"81","chanceoffrost":"25","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"900","tempC":"1","tempF":"35","windspeedMiles":"3","windspeedKmph":"5","winddirDegree":"308","winddir16Point":"NW","weatherCode":"323","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0011_light_snow_showers.png"}],"weatherDesc":[{"value":"Patchy light snow"}],"precipMM":"0.0","precipInches":"0.0","humidity":"78","visibility":"10","visibilityMiles":"6","pressure":"1025","pressureInches":"31","cloudcover":"62","HeatIndexC":"1","HeatIndexF":"35","DewPointC":"-2","DewPointF":"28","WindChillC":"-0","WindChillF":"32","WindGustMiles":"4","WindGustKmph":"6","FeelsLikeC":"-0","FeelsLikeF":"32","chanceofrain":"0","chanceofremdry":"93","chanceofwindy":"0","chanceofovercast":"59","chanceofsunshine":"56","chanceoffrost":"10","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1200","tempC":"5","tempF":"40","windspeedMiles":"4","windspeedKmph":"6","winddirDegree":"323","winddir16Point":"NW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"62","visibility":"10","visibilityMiles":"6","pressure":"1025","pressureInches":"31","cloudcover":"53","HeatIndexC":"5","HeatIndexF":"40","DewPointC":"-2","DewPointF":"29","WindChillC":"3","WindChillF":"38","WindGustMiles":"4","WindGustKmph":"7","FeelsLikeC":"3","FeelsLikeF":"38","chanceofrain":"0","chanceofremdry":"90","chanceofwindy":"0","chanceofovercast":"76","chanceofsunshine":"33","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1500","tempC":"6","tempF":"44","windspeedMiles":"4","windspeedKmph":"7","winddirDegree":"335","winddir16Point":"NNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"56","visibility":"10","visibilityMiles":"6","pressure":"1024","pressureInches":"31","cloudcover":"27","HeatIndexC":"6","HeatIndexF":"44","DewPointC":"-2","DewPointF":"29","WindChillC":"5","WindChillF":"41","WindGustMiles":"5","WindGustKmph":"8","FeelsLikeC":"5","FeelsLikeF":"41","chanceofrain":"0","chanceofremdry":"83","chanceofwindy":"0","chanceofovercast":"43","chanceofsunshine":"76","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1800","tempC":"5","tempF":"41","windspeedMiles":"5","windspeedKmph":"9","winddirDegree":"313","winddir16Point":"NW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"60","visibility":"10","visibilityMiles":"6","pressure":"1024","pressureInches":"31","cloudcover":"12","HeatIndexC":"5","HeatIndexF":"41","DewPointC":"-2","DewPointF":"28","WindChillC":"3","WindChillF":"38","WindGustMiles":"6","WindGustKmph":"10","FeelsLikeC":"3","FeelsLikeF":"38","chanceofrain":"0","chanceofremdry":"88","chanceofwindy":"0","chanceofovercast":"36","chanceofsunshine":"78","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"2100","tempC":"2","tempF":"36","windspeedMiles":"4","windspeedKmph":"7","winddirDegree":"291","winddir16Point":"WNW","weatherCode":"122","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Overcast"}],"precipMM":"0.0","precipInches":"0.0","humidity":"66","visibility":"10","visibilityMiles":"6","pressure":"1027","pressureInches":"31","cloudcover":"37","HeatIndexC":"2","HeatIndexF":"36","DewPointC":"-3","DewPointF":"26","WindChillC":"0","WindChillF":"33","WindGustMiles":"6","WindGustKmph":"10","FeelsLikeC":"0","FeelsLikeF":"33","chanceofrain":"0","chanceofremdry":"90","chanceofwindy":"0","chanceofovercast":"50","chanceofsunshine":"59","chanceoffrost":"5","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"}]},{"date":"2020-02-22","astronomy":[{"sunrise":"07:14 AM","sunset":"06:06 PM","moonrise":"06:56 AM","moonset":"04:52 PM","moon_phase":"New Moon","moon_illumination":"0"}],"maxtempC":"4","maxtempF":"39","mintempC":"-1","mintempF":"29","avgtempC":"1","avgtempF":"34","totalSnow_cm":"0.0","sunHour":"7.0","uvIndex":"1","hourly":[{"time":"0","tempC":"0","tempF":"33","windspeedMiles":"6","windspeedKmph":"9","winddirDegree":"275","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"68","visibility":"10","visibilityMiles":"6","pressure":"1028","pressureInches":"31","cloudcover":"80","HeatIndexC":"0","HeatIndexF":"33","DewPointC":"-5","DewPointF":"23","WindChillC":"-3","WindChillF":"27","WindGustMiles":"10","WindGustKmph":"16","FeelsLikeC":"-3","FeelsLikeF":"27","chanceofrain":"0","chanceofremdry":"82","chanceofwindy":"0","chanceofovercast":"69","chanceofsunshine":"36","chanceoffrost":"20","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"300","tempC":"-1","tempF":"31","windspeedMiles":"9","windspeedKmph":"14","winddirDegree":"282","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"75","visibility":"10","visibilityMiles":"6","pressure":"1028","pressureInches":"31","cloudcover":"31","HeatIndexC":"-1","HeatIndexF":"31","DewPointC":"-5","DewPointF":"24","WindChillC":"-5","WindChillF":"23","WindGustMiles":"15","WindGustKmph":"24","FeelsLikeC":"-5","FeelsLikeF":"23","chanceofrain":"0","chanceofremdry":"81","chanceofwindy":"0","chanceofovercast":"32","chanceofsunshine":"77","chanceoffrost":"33","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"600","tempC":"-1","tempF":"30","windspeedMiles":"10","windspeedKmph":"16","winddirDegree":"280","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"72","visibility":"10","visibilityMiles":"6","pressure":"1028","pressureInches":"31","cloudcover":"6","HeatIndexC":"-1","HeatIndexF":"30","DewPointC":"-6","DewPointF":"22","WindChillC":"-6","WindChillF":"21","WindGustMiles":"15","WindGustKmph":"24","FeelsLikeC":"-6","FeelsLikeF":"21","chanceofrain":"0","chanceofremdry":"82","chanceofwindy":"0","chanceofovercast":"39","chanceofsunshine":"83","chanceoffrost":"37","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"900","tempC":"0","tempF":"33","windspeedMiles":"11","windspeedKmph":"17","winddirDegree":"301","winddir16Point":"WNW","weatherCode":"326","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0011_light_snow_showers.png"}],"weatherDesc":[{"value":"Light snow"}],"precipMM":"0.0","precipInches":"0.0","humidity":"67","visibility":"10","visibilityMiles":"6","pressure":"1029","pressureInches":"31","cloudcover":"26","HeatIndexC":"0","HeatIndexF":"33","DewPointC":"-5","DewPointF":"23","WindChillC":"-4","WindChillF":"24","WindGustMiles":"13","WindGustKmph":"21","FeelsLikeC":"-4","FeelsLikeF":"24","chanceofrain":"0","chanceofremdry":"85","chanceofwindy":"0","chanceofovercast":"58","chanceofsunshine":"58","chanceoffrost":"20","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1200","tempC":"3","tempF":"37","windspeedMiles":"10","windspeedKmph":"16","winddirDegree":"346","winddir16Point":"NNW","weatherCode":"122","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Overcast"}],"precipMM":"0.0","precipInches":"0.0","humidity":"56","visibility":"10","visibilityMiles":"6","pressure":"1030","pressureInches":"31","cloudcover":"72","HeatIndexC":"3","HeatIndexF":"37","DewPointC":"-5","DewPointF":"23","WindChillC":"-1","WindChillF":"31","WindGustMiles":"12","WindGustKmph":"19","FeelsLikeC":"-1","FeelsLikeF":"31","chanceofrain":"0","chanceofremdry":"88","chanceofwindy":"0","chanceofovercast":"87","chanceofsunshine":"7","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1500","tempC":"4","tempF":"39","windspeedMiles":"9","windspeedKmph":"14","winddirDegree":"239","winddir16Point":"WSW","weatherCode":"371","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0012_heavy_snow_showers.png"}],"weatherDesc":[{"value":"Moderate or heavy snow showers"}],"precipMM":"0.0","precipInches":"0.0","humidity":"58","visibility":"9","visibilityMiles":"5","pressure":"1030","pressureInches":"31","cloudcover":"89","HeatIndexC":"4","HeatIndexF":"39","DewPointC":"-4","DewPointF":"25","WindChillC":"0","WindChillF":"33","WindGustMiles":"10","WindGustKmph":"17","FeelsLikeC":"0","FeelsLikeF":"33","chanceofrain":"24","chanceofremdry":"54","chanceofwindy":"0","chanceofovercast":"89","chanceofsunshine":"7","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"1800","tempC":"3","tempF":"37","windspeedMiles":"6","windspeedKmph":"9","winddirDegree":"110","winddir16Point":"ESE","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.1","precipInches":"0.0","humidity":"62","visibility":"8","visibilityMiles":"4","pressure":"1031","pressureInches":"31","cloudcover":"68","HeatIndexC":"3","HeatIndexF":"37","DewPointC":"-4","DewPointF":"26","WindChillC":"1","WindChillF":"33","WindGustMiles":"6","WindGustKmph":"10","FeelsLikeC":"1","FeelsLikeF":"33","chanceofrain":"47","chanceofremdry":"28","chanceofwindy":"0","chanceofovercast":"71","chanceofsunshine":"25","chanceoffrost":"3","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"2100","tempC":"2","tempF":"35","windspeedMiles":"2","windspeedKmph":"4","winddirDegree":"327","winddir16Point":"NNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"68","visibility":"10","visibilityMiles":"6","pressure":"1033","pressureInches":"31","cloudcover":"20","HeatIndexC":"2","HeatIndexF":"35","DewPointC":"-4","DewPointF":"26","WindChillC":"1","WindChillF":"33","WindGustMiles":"3","WindGustKmph":"5","FeelsLikeC":"1","FeelsLikeF":"33","chanceofrain":"0","chanceofremdry":"86","chanceofwindy":"0","chanceofovercast":"35","chanceofsunshine":"79","chanceoffrost":"10","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"}]},{"date":"2020-02-23","astronomy":[{"sunrise":"07:13 AM","sunset":"06:08 PM","moonrise":"07:28 AM","moonset":"05:54 PM","moon_phase":"New Moon","moon_illumination":"0"}],"maxtempC":"9","maxtempF":"48","mintempC":"-2","mintempF":"29","avgtempC":"3","avgtempF":"38","totalSnow_cm":"0.0","sunHour":"11.0","uvIndex":"11","hourly":[{"time":"0","tempC":"2","tempF":"35","windspeedMiles":"2","windspeedKmph":"4","winddirDegree":"309","winddir16Point":"NW","weatherCode":"113","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0008_clear_sky_night.png"}],"weatherDesc":[{"value":"Clear"}],"precipMM":"0.0","precipInches":"0.0","humidity":"72","visibility":"10","visibilityMiles":"6","pressure":"1034","pressureInches":"31","cloudcover":"4","HeatIndexC":"2","HeatIndexF":"35","DewPointC":"-3","DewPointF":"27","WindChillC":"1","WindChillF":"33","WindGustMiles":"3","WindGustKmph":"4","FeelsLikeC":"1","FeelsLikeF":"33","chanceofrain":"0","chanceofremdry":"88","chanceofwindy":"0","chanceofovercast":"20","chanceofsunshine":"89","chanceoffrost":"7","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"300","tempC":"1","tempF":"34","windspeedMiles":"2","windspeedKmph":"4","winddirDegree":"261","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"74","visibility":"10","visibilityMiles":"6","pressure":"1033","pressureInches":"31","cloudcover":"6","HeatIndexC":"1","HeatIndexF":"34","DewPointC":"-3","DewPointF":"27","WindChillC":"0","WindChillF":"33","WindGustMiles":"3","WindGustKmph":"5","FeelsLikeC":"0","FeelsLikeF":"33","chanceofrain":"0","chanceofremdry":"85","chanceofwindy":"0","chanceofovercast":"16","chanceofsunshine":"88","chanceoffrost":"13","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"600","tempC":"-1","tempF":"29","windspeedMiles":"3","windspeedKmph":"5","winddirDegree":"262","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"73","visibility":"10","visibilityMiles":"6","pressure":"1032","pressureInches":"31","cloudcover":"13","HeatIndexC":"-1","HeatIndexF":"29","DewPointC":"-6","DewPointF":"22","WindChillC":"-3","WindChillF":"27","WindGustMiles":"4","WindGustKmph":"7","FeelsLikeC":"-3","FeelsLikeF":"27","chanceofrain":"0","chanceofremdry":"92","chanceofwindy":"0","chanceofovercast":"48","chanceofsunshine":"74","chanceoffrost":"37","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"900","tempC":"2","tempF":"35","windspeedMiles":"4","windspeedKmph":"7","winddirDegree":"282","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"59","visibility":"10","visibilityMiles":"6","pressure":"1031","pressureInches":"31","cloudcover":"20","HeatIndexC":"2","HeatIndexF":"35","DewPointC":"-6","DewPointF":"21","WindChillC":"-1","WindChillF":"31","WindGustMiles":"6","WindGustKmph":"9","FeelsLikeC":"-1","FeelsLikeF":"31","chanceofrain":"0","chanceofremdry":"90","chanceofwindy":"0","chanceofovercast":"46","chanceofsunshine":"73","chanceoffrost":"20","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"11"},{"time":"1200","tempC":"6","tempF":"43","windspeedMiles":"6","windspeedKmph":"10","winddirDegree":"279","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"40","visibility":"10","visibilityMiles":"6","pressure":"1028","pressureInches":"31","cloudcover":"48","HeatIndexC":"6","HeatIndexF":"43","DewPointC":"-6","DewPointF":"20","WindChillC":"4","WindChillF":"40","WindGustMiles":"7","WindGustKmph":"12","FeelsLikeC":"4","FeelsLikeF":"40","chanceofrain":"0","chanceofremdry":"93","chanceofwindy":"0","chanceofovercast":"40","chanceofsunshine":"79","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"11"},{"time":"1500","tempC":"8","tempF":"47","windspeedMiles":"7","windspeedKmph":"11","winddirDegree":"282","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"41","visibility":"10","visibilityMiles":"6","pressure":"1026","pressureInches":"31","cloudcover":"49","HeatIndexC":"8","HeatIndexF":"47","DewPointC":"-4","DewPointF":"24","WindChillC":"6","WindChillF":"44","WindGustMiles":"8","WindGustKmph":"13","FeelsLikeC":"6","FeelsLikeF":"44","chanceofrain":"0","chanceofremdry":"89","chanceofwindy":"0","chanceofovercast":"41","chanceofsunshine":"85","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"11"},{"time":"1800","tempC":"6","tempF":"43","windspeedMiles":"5","windspeedKmph":"8","winddirDegree":"271","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"49","visibility":"10","visibilityMiles":"6","pressure":"1025","pressureInches":"31","cloudcover":"50","HeatIndexC":"6","HeatIndexF":"43","DewPointC":"-4","DewPointF":"25","WindChillC":"4","WindChillF":"40","WindGustMiles":"7","WindGustKmph":"12","FeelsLikeC":"4","FeelsLikeF":"40","chanceofrain":"0","chanceofremdry":"83","chanceofwindy":"0","chanceofovercast":"45","chanceofsunshine":"81","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"11"},{"time":"2100","tempC":"3","tempF":"38","windspeedMiles":"3","windspeedKmph":"5","winddirDegree":"260","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"50","visibility":"10","visibilityMiles":"6","pressure":"1025","pressureInches":"31","cloudcover":"49","HeatIndexC":"3","HeatIndexF":"38","DewPointC":"-6","DewPointF":"21","WindChillC":"2","WindChillF":"36","WindGustMiles":"7","WindGustKmph":"12","FeelsLikeC":"2","FeelsLikeF":"36","chanceofrain":"0","chanceofremdry":"82","chanceofwindy":"0","chanceofovercast":"40","chanceofsunshine":"75","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"}]},{"date":"2020-02-24","astronomy":[{"sunrise":"07:11 AM","sunset":"06:09 PM","moonrise":"07:55 AM","moonset":"06:54 PM","moon_phase":"New Moon","moon_illumination":"0"}],"maxtempC":"14","maxtempF":"57","mintempC":"2","mintempF":"35","avgtempC":"6","avgtempF":"42","totalSnow_cm":"0.0","sunHour":"11.0","uvIndex":"11","hourly":[{"time":"0","tempC":"3","tempF":"37","windspeedMiles":"3","windspeedKmph":"4","winddirDegree":"261","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"51","visibility":"10","visibilityMiles":"6","pressure":"1024","pressureInches":"31","cloudcover":"39","HeatIndexC":"3","HeatIndexF":"37","DewPointC":"-6","DewPointF":"21","WindChillC":"2","WindChillF":"36","WindGustMiles":"6","WindGustKmph":"9","FeelsLikeC":"2","FeelsLikeF":"36","chanceofrain":"0","chanceofremdry":"87","chanceofwindy":"0","chanceofovercast":"33","chanceofsunshine":"75","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"300","tempC":"3","tempF":"37","windspeedMiles":"3","windspeedKmph":"4","winddirDegree":"263","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"55","visibility":"10","visibilityMiles":"6","pressure":"1022","pressureInches":"31","cloudcover":"35","HeatIndexC":"3","HeatIndexF":"37","DewPointC":"-6","DewPointF":"22","WindChillC":"2","WindChillF":"35","WindGustMiles":"6","WindGustKmph":"9","FeelsLikeC":"2","FeelsLikeF":"35","chanceofrain":"0","chanceofremdry":"91","chanceofwindy":"0","chanceofovercast":"34","chanceofsunshine":"75","chanceoffrost":"3","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"600","tempC":"2","tempF":"36","windspeedMiles":"3","windspeedKmph":"5","winddirDegree":"263","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"55","visibility":"10","visibilityMiles":"6","pressure":"1020","pressureInches":"31","cloudcover":"41","HeatIndexC":"2","HeatIndexF":"36","DewPointC":"-6","DewPointF":"22","WindChillC":"1","WindChillF":"33","WindGustMiles":"7","WindGustKmph":"11","FeelsLikeC":"1","FeelsLikeF":"33","chanceofrain":"0","chanceofremdry":"87","chanceofwindy":"0","chanceofovercast":"41","chanceofsunshine":"72","chanceoffrost":"7","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"},{"time":"900","tempC":"5","tempF":"42","windspeedMiles":"4","windspeedKmph":"7","winddirDegree":"268","winddir16Point":"W","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"52","visibility":"10","visibilityMiles":"6","pressure":"1018","pressureInches":"31","cloudcover":"11","HeatIndexC":"5","HeatIndexF":"42","DewPointC":"-4","DewPointF":"25","WindChillC":"4","WindChillF":"39","WindGustMiles":"7","WindGustKmph":"12","FeelsLikeC":"4","FeelsLikeF":"39","chanceofrain":"0","chanceofremdry":"87","chanceofwindy":"0","chanceofovercast":"38","chanceofsunshine":"74","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"11"},{"time":"1200","tempC":"12","tempF":"53","windspeedMiles":"9","windspeedKmph":"15","winddirDegree":"285","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"39","visibility":"10","visibilityMiles":"6","pressure":"1017","pressureInches":"31","cloudcover":"9","HeatIndexC":"12","HeatIndexF":"53","DewPointC":"-2","DewPointF":"29","WindChillC":"10","WindChillF":"51","WindGustMiles":"11","WindGustKmph":"18","FeelsLikeC":"10","FeelsLikeF":"51","chanceofrain":"0","chanceofremdry":"91","chanceofwindy":"0","chanceofovercast":"40","chanceofsunshine":"73","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"11"},{"time":"1500","tempC":"12","tempF":"53","windspeedMiles":"17","windspeedKmph":"27","winddirDegree":"293","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"44","visibility":"10","visibilityMiles":"6","pressure":"1018","pressureInches":"31","cloudcover":"23","HeatIndexC":"12","HeatIndexF":"53","DewPointC":"-1","DewPointF":"30","WindChillC":"9","WindChillF":"48","WindGustMiles":"21","WindGustKmph":"34","FeelsLikeC":"9","FeelsLikeF":"48","chanceofrain":"0","chanceofremdry":"85","chanceofwindy":"0","chanceofovercast":"39","chanceofsunshine":"78","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"11"},{"time":"1800","tempC":"6","tempF":"43","windspeedMiles":"14","windspeedKmph":"23","winddirDegree":"293","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0002_sunny_intervals.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"69","visibility":"10","visibilityMiles":"6","pressure":"1021","pressureInches":"31","cloudcover":"48","HeatIndexC":"6","HeatIndexF":"43","DewPointC":"1","DewPointF":"33","WindChillC":"2","WindChillF":"35","WindGustMiles":"23","WindGustKmph":"36","FeelsLikeC":"2","FeelsLikeF":"35","chanceofrain":"0","chanceofremdry":"85","chanceofwindy":"0","chanceofovercast":"32","chanceofsunshine":"85","chanceoffrost":"0","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"11"},{"time":"2100","tempC":"3","tempF":"37","windspeedMiles":"9","windspeedKmph":"14","winddirDegree":"302","winddir16Point":"WNW","weatherCode":"116","weatherIconUrl":[{"value":"http://cdn.worldweatheronline.net/images/wsymbols01_png_64/wsymbol_0004_black_low_cloud.png"}],"weatherDesc":[{"value":"Partly cloudy"}],"precipMM":"0.0","precipInches":"0.0","humidity":"75","visibility":"10","visibilityMiles":"6","pressure":"1026","pressureInches":"31","cloudcover":"29","HeatIndexC":"3","HeatIndexF":"37","DewPointC":"-1","DewPointF":"30","WindChillC":"-1","WindChillF":"31","WindGustMiles":"14","WindGustKmph":"23","FeelsLikeC":"-1","FeelsLikeF":"31","chanceofrain":"0","chanceofremdry":"84","chanceofwindy":"0","chanceofovercast":"34","chanceofsunshine":"78","chanceoffrost":"3","chanceofhightemp":"0","chanceoffog":"0","chanceofsnow":"0","chanceofthunder":"0","uvIndex":"1"}]}],"ClimateAverages":[{"month":[{"index":"1","name":"January","avgMinTemp":"-5.1","avgMinTemp_F":"22.8","absMaxTemp":"6.2306776","absMaxTemp_F":"43.2","avgDailyRainfall":"0.84"},{"index":"2","name":"February","avgMinTemp":"-3.0","avgMinTemp_F":"26.7","absMaxTemp":"9.929138","absMaxTemp_F":"49.9","avgDailyRainfall":"0.61"},{"index":"3","name":"March","avgMinTemp":"0.4","avgMinTemp_F":"32.7","absMaxTemp":"13.041935","absMaxTemp_F":"55.5","avgDailyRainfall":"1.03"},{"index":"4","name":"April","avgMinTemp":"3.8","avgMinTemp_F":"38.8","absMaxTemp":"18.32725","absMaxTemp_F":"65.0","avgDailyRainfall":"1.33"},{"index":"5","name":"May","avgMinTemp":"6.8","avgMinTemp_F":"44.2","absMaxTemp":"21.823742","absMaxTemp_F":"71.3","avgDailyRainfall":"1.85"},{"index":"6","name":"June","avgMinTemp":"10.0","avgMinTemp_F":"49.9","absMaxTemp":"25.813334","absMaxTemp_F":"78.5","avgDailyRainfall":"2.26"},{"index":"7","name":"July","avgMinTemp":"11.8","avgMinTemp_F":"53.2","absMaxTemp":"28.241741","absMaxTemp_F":"82.8","avgDailyRainfall":"1.98"},{"index":"8","name":"August","avgMinTemp":"12.4","avgMinTemp_F":"54.3","absMaxTemp":"29.709677","absMaxTemp_F":"85.5","avgDailyRainfall":"0.84"},{"index":"9","name":"September","avgMinTemp":"9.5","avgMinTemp_F":"49.0","absMaxTemp":"24.453333","absMaxTemp_F":"76.0","avgDailyRainfall":"0.87"},{"index":"10","name":"October","avgMinTemp":"5.8","avgMinTemp_F":"42.4","absMaxTemp":"22.874193","absMaxTemp_F":"73.2","avgDailyRainfall":"0.78"},{"index":"11","name":"November","avgMinTemp":"2.8","avgMinTemp_F":"37.0","absMaxTemp":"14.126","absMaxTemp_F":"57.4","avgDailyRainfall":"0.88"},{"index":"12","name":"December","avgMinTemp":"-2.6","avgMinTemp_F":"27.4","absMaxTemp":"7.3903227","absMaxTemp_F":"45.3","avgDailyRainfall":"0.84"}]}]}}';

            $json = json_decode($clientResponse->getContent());
            //$json = json_decode($json);

            /**
             * @var User $user
             */
            $user = $this->getUser();

            $response['user'] = $user;
            $response['current_town'] = $json->data->request[0]->query;
            $date = \DateTime::createFromFormat('Y-m-d', $json->data->weather[0]->date);
            $response['current_day_of_week'] = $date->format('D');
            $response['current_weather_conditions'] = $json->data->current_condition[0]->weatherDesc[0]->value;
            $response['current_weather_icon'] = $json->data->current_condition[0]->weatherIconUrl[0]->value;
            $response['current_temp_c'] = $json->data->current_condition[0]->temp_C;
            $response['current_temp_f'] = $json->data->current_condition[0]->temp_F;
            $response['current_precipitation'] = $json->data->current_condition[0]->precipMM;
            $response['current_humidity'] = $json->data->current_condition[0]->humidity;
            $response['current_wind'] = $json->data->current_condition[0]->windspeedKmph;
            $response['forecast'] = [];

            $index = 0;
            foreach ($json->data->weather as $weatherItem) {
                $date = \DateTime::createFromFormat('Y-m-d', $weatherItem->date);
                $response['forecast'][$index]['day_of_week'] = $date->format('D');

                $response['forecast'][$index]['max_temp_c'] = $weatherItem->maxtempC;
                $response['forecast'][$index]['max_temp_f'] = $weatherItem->maxtempF;
                $response['forecast'][$index]['min_temp_c'] = $weatherItem->mintempC;
                $response['forecast'][$index]['min_temp_f'] = $weatherItem->mintempF;
                $response['forecast'][$index]['weather_icon'] = $weatherItem->hourly[3]->weatherIconUrl[0]->value;

                $index++;
            }

            $response['has_user_town'] = false;

            if ($user !== null) {
                $usersTownsRepository = $this->getDoctrine()->getRepository(UsersTowns::class);
                $usersTownsData = $usersTownsRepository->checkUserTown($user->getId(), $townId)->execute();
                if ($usersTownsData) {
                    $response['has_user_town'] = true;
                }
            }
        } else {
            $response['error_message'] = 'No town selected';
        }

        return Response::create(json_encode($response));
    }
}
